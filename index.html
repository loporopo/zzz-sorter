<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Zenless Zone Zero Character Sorter</title>
  <style>
    body { background-color: #111; color: #fff; font-family: sans-serif; text-align: center; padding: 2em; }
    h1 { font-size: 2em; }
    .char { display: inline-block; width: 300px; margin: 1em; }
    .char img { width: 250px; height: 250px; object-fit: cover; border-radius: 8px; border: 2px solid #444; }
    .char-name { margin-top: 0.5em; font-weight: bold; }
    .buttons button {
      margin: 0.5em; padding: 0.75em 2em; font-size: 1em;
      background-color: #333; color: white; border: none; border-radius: 6px; cursor: pointer;
    }
    .buttons button:hover { background-color: #555; }
    .results img { width: 100px; height: 100px; object-fit: cover; border-radius: 6px; margin-right: 1em; vertical-align: middle; }
    .setup { max-width: 600px; margin: auto; text-align: left; }
  </style>
</head>
<body>

<h1>Zenless Zone Zero Character Sorter</h1>

<div id="setup" class="setup">
  <h2>Select Factions to Include:</h2>
  <label><input type="checkbox" class="faction-filter" value="Phaethon" checked> Phaethon</label><br>
<label><input type="checkbox" class="faction-filter" value="Cunning Hares" checked> Cunning Hares</label><br>
<label><input type="checkbox" class="faction-filter" value="Belobog Industries" checked> Belobog Industries</label><br>
<label><input type="checkbox" class="faction-filter" value="Victoria Housekeeping Co." checked> Victoria Housekeeping Co.</label><br>
<label><input type="checkbox" class="faction-filter" value="Obol Squad" checked> Obol Squad</label><br>
<label><input type="checkbox" class="faction-filter" value="Silver Squad" checked> Silver Squad</label><br>
<label><input type="checkbox" class="faction-filter" value="N.E.P.S" checked> N.E.P.S</label><br>
<label><input type="checkbox" class="faction-filter" value="Sons of Calydon" checked> Sons of Calydon</label><br>
<label><input type="checkbox" class="faction-filter" value="Section 6" checked> Section 6</label><br>
<label><input type="checkbox" class="faction-filter" value="Stars of Lyra" checked> Stars of Lyra</label><br>
<label><input type="checkbox" class="faction-filter" value="Mockingbird" checked> Mockingbird</label><br>
<label><input type="checkbox" class="faction-filter" value="Yunkui Summit" checked> Yunkui Summit</label><br>
<label><input type="checkbox" class="faction-filter" value="Spook Shack" checked> Spook Shack</label><br>
  <button onclick="initSort()">Start Sorting</button>
</div>

<div id="sorter" style="display:none;">
  <div class="char" id="charA"><img id="imgA" src=""><div class="char-name" id="nameA"></div></div>
  <div class="char" id="charB"><img id="imgB" src=""><div class="char-name" id="nameB"></div></div>
  <div class="buttons">
    <button onclick="choose(0)">← Choose A</button>
    <button onclick="tie()">Tie</button>
    <button onclick="choose(1)">Choose B →</button>
    <button onclick="undo()">Undo</button>
  </div>
</div>

<div id="results" class="results"></div>

<script>
const allCharacters = [
  { name: "Belle", img: "images/Belle.png", faction: "Phaethon" },
  { name: "Wise", img: "images/Wise.png", faction: "Phaethon" },
  { name: "Anby Demara", img: "images/Anby_Demara.png", faction: "Cunning Hares" },
  { name: "Billy Kid", img: "images/Billy_Kid.png", faction: "Cunning Hares" },
  { name: "Nicole Demara", img: "images/Nicole_Demara.png", faction: "Cunning Hares" },
  { name: "Nekomiya Mana", img: "images/Nekomiya_Mana.png", faction: "Cunning Hares" },
  { name: "Anton Ivanov", img: "images/Anton_Ivanov.png", faction: "Belobog Industries" },
  { name: "Ben Bigger", img: "images/Ben_Bigger.png", faction: "Belobog Industries" },
  { name: "Koleda Belobog", img: "images/Koleda_Belobog.png", faction: "Belobog Industries" },
  { name: "Grace Howard", img: "images/Grace_Howard.png", faction: "Belobog Industries" },
  { name: "Corin Wickes", img: "images/Corin_Wickes.png", faction: "Victoria Housekeeping Co." },
  { name: "Alexandrina “Rina” Sebastiane", img: "images/Alexandrina_Rina_Sebastiane.png", faction: "Victoria Housekeeping Co." },
  { name: "Von Lycaon", img: "images/Von_Lycaon.png", faction: "Victoria Housekeeping Co." },
  { name: "Ellen Joe", img: "images/Ellen_Joe.png", faction: "Victoria Housekeeping Co." },
  { name: "Soldier 11", img: "images/Soldier11.png", faction: "Obol Squad" },
  { name: "Trigger", img: "images/Trigger.png", faction: "Obol Squad" },
  { name: "Soldier 0: Anby", img: "images/Soldier_0_Anby.png", faction: "Silver Squad" },
  { name: "Zhu Yuan", img: "images/Zhu_Yuan.png", faction: "N.E.P.S" },
  { name: "Qingyi", img: "images/Qingyi.png", faction: "N.E.P.S" },
  { name: "Jane Doe", img: "images/Jane_Doe.png", faction: "N.E.P.S" },
  { name: "Seth Lowell", img: "images/Seth_Lowell.png", faction: "N.E.P.S" },
  { name: "Caesar King", img: "images/Caesar_King.png", faction: "Sons of Calydon" },
  { name: "Luciana de Montefio", img: "images/Luciana_de_Montefio.png", faction: "Sons of Calydon" },
  { name: "Piper Wheel", img: "images/Piper_Wheel.png", faction: "Sons of Calydon" },
  { name: "Burnice White", img: "images/Burnice_White.png", faction: "Sons of Calydon" },
  { name: "Lighter", img: "images/Lighter.png", faction: "Sons of Calydon" },
  { name: "Pulchra Fellini", img: "images/Pulchra_Fellini.png", faction: "Sons of Calydon" },
  { name: "Hoshimi Miyabi", img: "images/Hoshimi_Miyabi.png", faction: "Section 6" },
  { name: "Soukaku", img: "images/Soukaku.png", faction: "Section 6" },
  { name: "Tsukishiro Yanagi", img: "images/Tsukishiro_Yanagi.png", faction: "Section 6" },
  { name: "Asaba Harumasa", img: "images/Asaba_Harumasa.png", faction: "Section 6" },
  { name: "Astra Yao", img: "images/Astra_Yao.png", faction: "Stars of Lyra" },
  { name: "Evelyn Chevalier", img: "images/Evelyn_Chevalier.png", faction: "Stars of Lyra" },
  { name: "Hugo Vlad", img: "images/Hugo_Vlad.png", faction: "Mockingbird" },
  { name: "Vivian Banshee", img: "images/Vivian_Banshee.png", faction: "Mockingbird" },
  { name: "Ju Fufu", img: "images/Ju_Fufu.png", faction: "Yunkui Summit" },
  { name: "Pan Yinhu", img: "images/Pan_Yinhu.png", faction: "Yunkui Summit" },
  { name: "Yixuan", img: "images/Yixuan.png", faction: "Yunkui Summit" },
  { name: "Ukinami Yuzuha", img: "images/Ukinami_Yuzuha.png", faction: "Spook Shack" },
  { name: "Alice Thymefield", img: "images/Alice_Thymefield.png", faction: "Spook Shack" }
];

let workingList = [];
let history = [];

let rounds = [];
let currentRound = [];
let roundIndex = 0;
let resultList = [];

function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function initSort() {
  const allowed = Array.from(document.querySelectorAll('.faction-filter:checked')).map(e => e.value);
  workingList = allCharacters.filter(c => allowed.includes(c.faction));
  if (workingList.length < 2) return alert("Select at least two characters.");
  document.getElementById('setup').style.display = 'none';
  document.getElementById('sorter').style.display = 'block';
  workingList = shuffle(workingList);
  generateRounds(workingList.map(c => [c]));
  nextMatch();
}

function generateRounds(pairs) {
  if (pairs.length <= 1) { resultList = pairs[0].merged; return; }
  let round = [];
  for (let i = 0; i < pairs.length; i += 2) {
    if (i + 1 < pairs.length) {
      round.push([pairs[i], pairs[i+1]]);
    } else {
      round.push([pairs[i], []]);
    }
  }
  rounds.push(round);
  generateRounds(round.map(() => [])); // Placeholder for result nesting
}

let leftList = [], rightList = [], mergedList = [], matchPointer = 0;

function nextMatch() {
  if (rounds.length === 0) return showResults();

  currentRound = rounds[0];
  if (matchPointer >= currentRound.length) {
    // Replace round with merged results
    rounds.shift();
    if (rounds.length > 0) {
      for (let i = 0; i < currentRound.length; i++) {
        rounds[0][Math.floor(i / 2)][i % 2] = currentRound[i].merged;
      }
    }
    matchPointer = 0;
    return nextMatch();
  }

  [leftList, rightList] = currentRound[matchPointer];
  mergedList = [];
  compareNext();
}

function compareNext() {
  if (leftList.length === 0 && rightList.length === 0) {
    currentRound[matchPointer].merged = mergedList;
    matchPointer++;
    return nextMatch();
  }
  if (leftList.length === 0) return (mergedList.push(rightList.shift()), compareNext());
  if (rightList.length === 0) return (mergedList.push(leftList.shift()), compareNext());

  document.getElementById('imgA').src = leftList[0].img;
  document.getElementById('nameA').textContent = leftList[0].name;
  document.getElementById('imgB').src = rightList[0].img;
  document.getElementById('nameB').textContent = rightList[0].name;
}

function choose(choice) {
  const picked = choice === 0 ? leftList.shift() : rightList.shift();
  mergedList.push(picked);
  history.push({
    left: [...leftList], right: [...rightList], merged: [...mergedList], matchPointer, round: JSON.stringify(currentRound)
  });
  compareNext();
}

function tie() {
  mergedList.push(leftList.shift());
  mergedList.push(rightList.shift());
  history.push({
    left: [...leftList], right: [...rightList], merged: [...mergedList], matchPointer, round: JSON.stringify(currentRound)
  });
  compareNext();
}

function undo() {
  if (!history.length) return;
  const last = history.pop();
  leftList = [...last.left];
  rightList = [...last.right];
  mergedList = [...last.merged];
  matchPointer = last.matchPointer;
  currentRound = JSON.parse(last.round);
  compareNext();
}

function showResults() {
  const container = document.getElementById('results');
  document.getElementById('sorter').style.display = 'none';
  container.innerHTML = "<h2>Final Ranking:</h2><ol>" + resultList.map(c =>
    `<li><img src="${c.img}">${c.name}</li>`).join("") + "</ol>";
}
</script>

</body>
</html>
